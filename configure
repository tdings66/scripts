#!/bin/bash
#
#
cd $HOME
if [ -r Luggage ] && [ ! -d Luggage ]
then
    rm Luggage
fi
if [ ! -L Luggage ] && [ ! -d Luggage ]
then 
    ln -s /mnt/hgfs/Luggage .
fi
if [ ! -d .ssh ]
then
    mkdir .ssh
fi
if [ ! -r .ssh/id_rsa ]
then
    cp Luggage/RSA\ Keys/id_rsa .ssh
    chmod 600 .ssh/id_rsa
fi
if [ ! -r .ssh/id_rsa.pub ]
then
    cp Luggage/RSA\ Keys/id_rsa.pub .ssh
    chmod 600 .ssh/id_rsa.pub
fi
if [ ! -r .ssh/authorized_keys ]
then
    cp .ssh/id_rsa.pub .ssh/authorized_keys
    chmod 600 .ssh/authorized_keys
fi

link ()
{
    used=$1
    gitStored=$2

    diff $used $gitStored 2>/dev/null
    if [ 0 -ne $? ]
    then
        rm $used
        ln $gitStored $used
    fi
}

GIT_SCRIPTS=$HOME/git/scripts

link $HOME/.profile 		$GIT_SCRIPTS/.profile
link $HOME/.bashrc 		$GIT_SCRIPTS/.bashrc
link $HOME/.gitconfig 		$GIT_SCRIPTS/.gitconfig
link $HOME/.git_message.txt 	$GIT_SCRIPTS/.git_message.txt
link $HOME/.emacs.d/init.el 	$GIT_SCRIPTS/init.el
link $HOME/.emacs.d/log-mode.el $GIT_SCRIPTS/bin/log-mode.el
link $HOME/.byobu/.tmux.conf 	$GIT_SCRIPTS/.tmux.conf
link $HOME/.gdbinit 		$GIT_SCRIPTS/bin/.gdbinit
link $HOME/.byobu/status 	$GIT_SCRIPTS/status

if [ ! -d .emacs.d/vendor ]
then
    mkdir .emacs.d/vendor
fi

tools_mnt=`grep svt-tools02 /etc/fstab`
if [ -z "$tools_mnt" ]
then
    sudo mkdir -p /Support
    sudo sh -c "echo svt-tools02:/captures/Support /Support nfs >> /etc/fstab"
    sudo mount /Support
fi

cron_entry=`crontab -l | grep git_backup`
if [ -z "$cron_entry" ]
then
    echo "Adding the following line to you crontab"
    ct_line="0,15,30,45 * * * * $HOME/git/scripts/bin/git_backup"
    echo "    $ct_line"
    crontab -l | crontab <<EOF
$ct_line
EOF
fi
# crashplan_proc=`ps -fe | grep CrashPlanService`
# if [ -z "$crashplan_proc" ]
# then
#     echo "Please install and configure CrashPlanPro to automate backup of:"
#     echo "    $HOME/git.backup"
#     echo "Getting CrashlanPro from here..."
#     echo "    http://www.code42.com/business"
#     echo "    http://www.code42.com/r/dl/client/CrashPlanPRO/linux/3.6.4"
#     if [ ! -r $HOME/Downloads/CrashPlanPRO_3.6.4_Linux.tar ]
#     then
#         mkdir -p Downloads 2>/dev/null
#         cd Downloads
#         wget http://www.code42.com/r/dl/client/CrashPlanPRO/linux/3.6.4
#         gunzip CrashPlanPRO_3.6.4_Linux.tgz
#         tar xf CrashPlanPRO_3.6.4_Linux.tar
#         echo "    Run:"
#         echo "        $HOME/Downloads/CrashPlanPRO-install/install.sh"
#         echo "    to install Crash Plan"
#         cd $HOME
#     fi
# fi
