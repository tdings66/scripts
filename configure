#!/bin/bash
#
#
cd $HOME
if [ -r Luggage ] && [ ! -d Luggage ]
then
    rm Luggage
fi
if [ ! -L Luggage ] && [ ! -d Luggage ]
then 
    ln -s /mnt/hgfs/Luggage .
fi
if [ ! -d .ssh ]
then
    mkdir .ssh
fi
if [ ! -r .ssh/id_rsa ]
then
    cp Luggage/RSA\ Keys/id_rsa .ssh
    chmod 600 .ssh/id_rsa
fi
if [ ! -r .ssh/id_rsa.pub ]
then
    cp Luggage/RSA\ Keys/id_rsa.pub .ssh
    chmod 600 .ssh/id_rsa.pub
fi
if [ ! -r .ssh/authorized_keys ]
then
    cp .ssh/id_rsa.pub .ssh/authorized_keys
    chmod 600 .ssh/authorized_keys
fi

diff .profile $HOME/git/scripts/.profile 2>/dev/null
if [ 0 -ne $? ]
then
    rm .profile
    ln $HOME/git/scripts/.profile .
fi
diff .bashrc $HOME/git/scripts/.bashrc 2>/dev/null
if [ 0 -ne $? ]
then
    rm .bashrc
    ln $HOME/git/scripts/.bashrc .
fi
diff .gitconfig $HOME/git/scripts/.gitconfig 2>/dev/null
if [ 0 -ne $? ]
then
    rm .gitconfig
    ln $HOME/git/scripts/.gitconfig .
fi
diff .git_message.txt $HOME/got/scripts/.git_message.txt 2>/dev/null
if [ 0 -ne $? ]
then
    rm .git_message.txt
    ln -s $HOME/git/scripts/.git_message.txt .
fi
diff .emacs.d/init.el $HOME/git/scripts/init.el 2>/dev/null
if [ 0 -ne $? ]
then
    rm .emacs.d/init.el
    ln $HOME/git/scripts/init.el .emacs.d/init.el
fi

if [ ! -d .emacs.d/vendor ]
then
    mkdir .emacs.d/vendor
fi

cron_entry=`crontab -l | grep git_backup`
if [ -z "$cron_entry" ]
then
    echo "Adding the following line to you crontab"
    ct_line="0,15,30,45 * * * * $HOME/git/scripts/bin/git_backup"
    echo "    $ct_line"
    crontab -l | crontab <<EOF
$ct_line
EOF
fi
crashplan_proc=`ps -fe | grep CrashPlanService`
if [ -z "$crashplan_proc" ]
then
    echo "Please install and configure CrashPlanPro to backup:"
    echo "    $HOME/git.backup"
    echo "Get CrashlanPro from here:"
    echo "    http://www.code42.com/business"
fi
