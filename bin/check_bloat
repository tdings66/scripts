#!/bin/bash

file="$1"
if [ -z "$file" ]
then
    echo "$0 usage:"
    echo "\tSpecify a VMDK-flat file name as an agrement"
    exit
fi

offset=`fdisk -l "$file" | egrep "^$file" | tail -1 | awk '{print $2}'`

mkdir -p /mnt/tmp
mount -t ntfs -o ro,loop,offset=$(($offset * 512)) "$file" /mnt/tmp
vmSize=`ls -ls "$file" | awk '{print $1}'`
winSize=`df /mnt/tmp | grep /mnt/tmp | awk '{print $3}'`
echo "On `date` Bloat was $(($vmSize - $winSize))   Windows: $winSize  VMware: $vmSize"
umount /dev/loop0
